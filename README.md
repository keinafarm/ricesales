# 招待制・お米販売ECシステム (Rice Store EC System)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 概要

本プロジェクトは、小規模な農家さんが特定の招待制顧客（友人・知人など）にお米をオンラインで販売するために特化した、高機能なECシステムです。

単なる販売サイトではなく、注文受付から在庫管理、袋詰、梱包、発送管理（ヤマトB2クラウド連携）まで、一連の煩雑なバックヤード業務を強力に支援することを目的としています。管理者の思考や判断をシステムが肩代わりし、常に最適なアクションを提案することで、業務の効率化とミスの防止を目指します。

<br>

## 主な機能

このシステムは、購入者向けの基本的なEC機能と、管理者向けの高度な業務支援機能を提供します。

### 管理者向け機能
- **ToDoリスト形式のダッシュボード**: ログイン後、次に行うべき作業（新規注文、要袋詰、未入金など）が一目でわかります。
- **高度な出荷ワークフロー**:
    - **袋詰管理**: 受注内容から必要な袋数を自動で集計し、物理的な袋在庫を管理します。
    - **自動引当・梱包ボード**: ドラッグ＆ドロップ対応の直感的なUIで、注文と袋在庫を紐付け、最適な梱包案をシステムが自動で提案します。
    - **発送管理**: 梱包が完了した荷物を一覧で管理し、ヤマト運輸のB2クラウドシステムと連携するためのCSV入出力機能を提供します。
- **柔軟な注文・顧客管理**: 発送前の注文内容（商品、数量、価格）の編集や、専用UIでの顧客情報・お届け先管理が可能です。
- **リアルタイム在庫管理**: 品種ごとの在庫を「総供給量」と「総注文量」で管理し、管理画面から安全に在庫調整ができます。
- **データ移行機能**: 旧システムからエクスポートしたSQLファイルをもとに、顧客・お届け先情報を一括でインポートできます。

### 購入者向け機能
- **お届け先ごとのショッピングカート**: 「自宅用」「実家への贈り物用」など、複数の配送グループを同時に管理できます。
- **リアルタイム在庫表示**: 商品の購入可能在庫数がリアルタイムで表示され、在庫を超える注文はできません。
- **参考送料の提示**: 注文確認画面で、カートの内容に基づいた梱包シミュレーションを行い、見込みの送料を提示します。
- **注文履歴とステータス確認**: 自身の注文状況や、送料が確定済みかどうかが確認できます。
- **請求書PDFダウンロード**: 複数の注文をまとめた請求書をいつでもダウンロードできます。送料の確定状況に応じて、暫定額・確定額が正しく表示されます。

<br>

## 使用技術 (Technology Stack)

- **Backend**: Django 4.2
- **Frontend**: Bootstrap 5, JavaScript (APIによる非同期通信)
- **Database**: MySQL 8.0
- **Infrastructure**: Docker, Docker Compose
- **Production Proxy**: Traefik (for HTTPS/Let's Encrypt)

<br>

## ローカル開発環境のセットアップ

Docker DesktopとGitがインストールされていれば、以下の手順で簡単にローカル開発環境を構築できます。

1.  **リポジトリをクローン**
    ```bash
    git clone https://github.com/your-username/your-repository-name.git
    cd your-repository-name
    ```

2.  **環境変数ファイルを作成**
    `env.production.template` をコピーして `env.development` というファイル名で保存します。中身は開発用なので、SECRET_KEY以外は特に変更しなくても動作します。
    ```bash
    cp env.production.template env.development
    ```

3.  **コンテナのビルドと起動**
    ```bash
    docker compose -f docker-compose.dev.yml up -d --build
    ```

4.  **データベースの初期化（マイグレーション）**
    ```bash
    docker compose -f docker-compose.dev.yml exec app python manage.py migrate
    ```

5.  **管理者アカウントの作成**
    ```bash
    docker compose -f docker-compose.dev.yml exec app python manage.py createsuperuser
    ```
    画面の指示に従い、ID、パスワードなどを設定してください。

6.  **アクセス**
    ブラウザで `http://localhost:8000/accounts/login/` を開くと、ログイン画面が表示されます。

<br>

## プロジェクト構成

本システムは、Djangoのベストプラクティスに基づき、機能ごとに責務が明確に分割されたアプリケーション群で構成されています。

| アプリケーション名  | 役割と責務                                                                                                                              |
| :---------------- | :-------------------------------------------------------------------------------------------------------------------------------------- |
| **`accounts`**    | **人に関するデータ管理**: 顧客 (`User`) とお届け先 (`Destination`) のモデルを定義し、認証機能を提供。                                         |
| **`products`**    | **モノの定義データ管理**: 品種 (`ProductVariety`)、商品 (`Product`)、在庫 (`Stock`) のマスターデータを管理。                                    |
| **`orders`**      | **取引と物理的なモノの状態管理**: 注文 (`Order`)、引当 (`Allocation`)、袋 (`Bag`)、荷物 (`Package`) など、業務フローの中核となるモデル群を定義。 |
| **`cart`**        | **一時的な状態管理**: ログインユーザーのセッションに基づき、ショッピングカート機能を提供。                                                     |
| **`system_settings`** | **システム全体の設定値管理**: 店舗情報、送料、各種係数、振込先口座情報などを管理。                                                       |
| **`dashboard`**   | **管理者向け機能の統括（司令塔）**: 管理者向けトップページ、デバッグ画面、データ移行、マニュアル管理など、横断的な機能を提供。                |
| **`mg_orders`**   | **【管理者】注文管理**: 注文の一覧表示、受付、編集機能および関連APIを提供。                                                                 |
| **`mg_customers`**| **【管理者】顧客管理**: 顧客の一覧表示、新規作成、詳細編集機能および関連APIを提供。                                                         |
| **`mg_masters`**  | **【管理者】マスタ管理**: 品種・商品・在庫のCRUD機能および関連APIを提供。                                                                   |
| **`mg_workflow`** | **【管理者】出荷ワークフロー**: 袋詰管理、自動引当ボード、発送管理の各画面と、それらを支える複雑なビジネスロジックおよびAPI群を提供。        |

<br>

## 謝辞 (Acknowledgements)

このプロジェクトのコードは、設計のアイデア出しから具体的な実装、ドキュメンテーションに至るまで、その大部分が **Google AI Studio (Gemini)** との対話を通じて生成されました。

<br>

## ライセンス (License)

このプロジェクトはMITライセンスの下で公開されています。詳細については `LICENSE` ファイルをご覧ください。
